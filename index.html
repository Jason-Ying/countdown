<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
	<title>沉浸式网课 | SESCountdown</title>
	<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1" name="viewport">
	<meta content="" name="keywords">
	<meta content="" name="description">
	<link href="./assets/layout/common.min.css" rel="stylesheet">
	<link href="./assets/layout/all.min.css" rel="stylesheet">
	<style>
		.cd-time {
			font-size: 6.5rem;
			color: red;
			white-space: pre;
		}

		.cd-descr {
			font-size: 2rem;
		}

		.cd-title {
			font-size: 5.5rem;
			color: red;
			white-space: pre;
		}

		.cd-music {
			font-size: 1.2rem;
			position: absolute;
			margin: auto;
			left: 0;
			right: 0;
			bottom: 10rem;
		}

		.cd-header {
			font-weight: 2;
		}

		.cd-footer {
			position: absolute;
			margin: auto;
			left: 0;
			right: 0;
			bottom: 1rem;
		}
	</style>
</head>

<body>
	<div>
		<div class="text-center py-5 cd-header">
			<b class="cd-descr">距离</b>
			<b class="cd-descr" id="title-to">某天</b>
			<b class="cd-descr" id="title-pre">第某节课</b>
			<a class="cd-title" id="title"> 某节课 </a>
			<b class="cd-descr" id="title-sub">上/下课</b>
			<b class="cd-descr" id="descr">还有</b>
		</div>
		<div class="text-center text-muted">
			<a id="nxt">下节/当前：某节休息</a>
		</div>
		<div class="text-center" id="cd-time">
			<a class="cd-time" id="hor"> 00 </a> <b class="cd-descr">小时</b>
			<a class="cd-time" id="min"> 00 </a> <b class="cd-descr">分钟</b>
			<a class="cd-time" id="sec"> 00 </a> <b class="cd-descr">秒</b>
		</div>
		<div style="display: none" class="text-center cd-music text-muted" id="cd-music">
			<i class="fa fa-music"></i>
			<a>当前播放：</a>
			<a id="music-name">某首歌</a>
		</div>
		<div class="text-center cd-footer text-muted">
			<a>SESCountdown v0.2</a><br>
			<a>Made By JasonYing.</a>
		</div>
	</div>
	<script>
		let timeStampList = ["0800", "0840", "0850", "0930", "0955", "1035", "1045", "1125", "1230", "1310", "1320", "1400", "1410", "1450", "1510", "1550", "1600", "1650", "2400"];
		let timeStampDescrPre = ["第一节课", "第一节课", "第二节课", "第二节课", "第三节课", "第三节课", "第四节课", "第四节课", "第五节课", "第五节课", "第六节课", "第六节课", "第七节课", "第七节课", "第八节课", "第八节课", "第九节课", "第九节课", ""];
		let timeStampDescrSub = ["上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", ""];
		let timeStampMusic = [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, -1];
		let schedList = [
			["化学", "升旗仪式", "英语", "数学", "体育", "劳技", "物理", "语文", "TI"],
			["思想政治", "数学", "语文", "语文", "英语", "化学", "生物", "历史", "体育"],
			["物理", "历史", "信息科技", "信息科技", "语文", "数学", "音乐美术", "英语", "体育"],
			["英语", "数学", "物理", "语文", "地理", "化学", "特需自修", "特需自修", "特需自修"],
			["化学", "数学", "历史", "英语", "物理", "思想政治", "班会", "无", "无"]
		];
		let musicList = ["pre.aac", "on.aac", "off.aac", "eye.mp3", "body.mp3", "neversaygoodbye.mp3"];
		let musicDescr = ["预备铃", "上课铃", "下课铃", "眼保健操", "广播体操", "Never Say Goodbye"];
		let spanList = ["放学", "课间", "大课间", "课间", "午休", "课间", "课间", "大课间", "课间", "放学"];
		let event = ["0758", "0848", "0931", "0950", "1043", "1205", "1228", "1318", "1408", "1505", "1558", "1700"];
		let eventMusic = [0, 0, 4, 3, 0, -1, 0, 0, 0, 3, 0, 5];
	</script>
	<script>
		let player;
		function playMusic(n) {
			if (n == -1) return;
			let s = musicList[n];
			$("#music-name").text(musicDescr[n]);
			$("#cd-music").fadeIn(2000);
			let mp3 = "./assets/music/" + s;
			player = new Audio(mp3);
			document.getElementById("cd-music").appendChild(player);
			player.play();
			player.addEventListener("ended", function () {
				$("#cd-music").fadeOut(2000);
			}, false)
		}
		function add0(s) {
			return ("00" + s).substr(-2);
		}
		function getNowStr() {
			return add0(new Date().getHours().toString()) + add0(new Date().getMinutes().toString());
		}
		function getAdjDay() {
			return (new Date().getDay() - 1 + 7) % 7 + 1;
		}
		function nxtSchedId() {
			if (toNxtWorkDay()) return 0;
			let nowStr = getNowStr();
			let i;
			for (i = 0; i < timeStampList.length; i++) {
				if (nowStr < timeStampList[i]) return i;
			}
		}
		function str2time(n) {
			let todayStart = new Date().getTime() - new Date().getHours() * 60 * 60 * 1000 - new Date().getMinutes() * 60 * 1000 - new Date().getSeconds() * 1000 - new Date().getMilliseconds();
			let thisHour = parseInt(timeStampList[n].substring(0, 2));
			let thisMin = parseInt(timeStampList[n].substring(2, 4));
			let nowTime = todayStart + thisHour * 60 * 60 * 1000 + thisMin * 60 * 1000;
			return nowTime;
		}
		let toNxtDescr = ["-1", "明天", "后天"];
		function toNxtWorkDay() {
			let nowDay = getAdjDay();
			if (nowDay >= 1 && nowDay <= 5) return 0;
			$("#title-to").text(toNxtDescr[8 - nowDay]);
			return 8 - nowDay;
		}
		let delta, nxtId, preId, preStr;
		function refr() {
			if (preStr != getNowStr() && !toNxtWorkDay()) {
				preStr = getNowStr();
				for (let i = 0; i < event.length; i++) {
					if (event[i] == preStr) {
						playMusic(eventMusic[i]);
						break;
					}
				}
			}
			nxtId = nxtSchedId();
			delta = str2time(nxtId) - new Date().getTime();
			delta = delta / 1000 + (toNxtWorkDay() * 24 * 60 * 60);
			updTime();
			if (nxtId != preId) updSched();
		}
		function updTime() {
			let hor = Math.floor(delta / 3600);
			let min = Math.floor(delta / 60 - hor * 60);
			let sec = Math.floor(delta - hor * 3600 - min * 60);
			$("#hor").html(" " + add0(hor) + " ");
			$("#min").html(" " + add0(min) + " ");
			$("#sec").html(" " + add0(sec) + " ");
		}
		function updSched() {
			playMusic(nxtId - 1);
			pre = nxtId;
			if (nxtId % 2 == 0) $("#nxt").text("当前：" + spanList[Math.floor(nxtId / 2)]);
			else $("#nxt").text("下节：" + spanList[Math.floor(nxtId / 2)]);
			$("#title-pre").text(timeStampDescrPre[nxtId]);
			if (Math.floor(nxtId / 2) >= schedList[(getAdjDay() + toNxtWorkDay()) % 7 - 1].length) $("#title").innerText = " 明天 ";
			else $("#title").text(" " + schedList[(getAdjDay() + toNxtWorkDay()) % 7 - 1][Math.floor(nxtId / 2)] + " ");
			$("#title-sub").text(timeStampDescrSub[nxtId]);
		}
		setInterval(function () { refr() }, 1000);
	</script>
</body>

</html>