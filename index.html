<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
	<title>沉浸式网课 | SESCountdown</title>
	<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1" name="viewport">
	<meta content="" name="keywords">
	<meta content="" name="description">
	<link href="./assets/layout/common.min.css" rel="stylesheet">
	<link href="./assets/layout/all.min.css" rel="stylesheet">
	<style>
		.modal-side {
			z-index: 1100;
			position: fixed;
			width: 20%;
			height: 100%;
			left: 0;
			top: 0;
			bottom: 0;
			background-color: white;
			overflow-y: auto;
			padding: 1rem;
		}

		.cd-tabs {
			position: absolute;
			margin-top: 1rem;
			margin-left: 1rem;
		}

		.cd-tab {
			padding: 0.5rem;
			margin: 0.05rem;
			float: left;
		}

		.cd-tabs-right {
			position: absolute;
			right: 0;
			margin-top: 1rem;
			margin-right: 1rem;
		}

		.cd-tab-right {
			padding: 0.5rem;
			margin: 0.05rem;
			float: right;
		}

		.cd-tab:hover {
			cursor: pointer;
			border-radius: 0.2rem;
			background-color: lightgrey;
		}

		.cd-title {
			font-size: 5.5rem;
			color: red;
			white-space: pre;
		}

		.cd-descr {
			font-size: 2rem;
		}

		.cd-header {
			font-weight: 2;
		}

		.cd-time {
			font-size: 6.5rem;
			color: red;
			white-space: pre;
		}

		.cd-music {
			font-size: 1.2rem;
			position: absolute;
			margin: auto;
			left: 0;
			right: 0;
			bottom: 10rem;
		}

		.cd-footer {
			position: absolute;
			margin: auto;
			left: 0;
			right: 0;
			bottom: 1rem;
		}

		.tab-list {
			cursor: pointer;
			color: black;
			width: 100%;
			overflow: hidden;
			margin-bottom: 0.5rem;
			margin-left: 0.2rem;
		}

		.tab-list:hover {
			color: rgb(45, 45, 255);
		}

		.list-label {
			float: left;
			color: white;
			background-color: grey;
			border-radius: 0.2rem;
			padding: 0.2rem;
			font-size: 0.2rem;
			margin-right: 0.5rem;
		}

		.list-label.notin {
			background-color: grey;
		}

		.list-label.in {
			background-color: green;
		}

		.list-cont {
			left: 0;
			float: left;
		}
	</style>
</head>

<body>
	<div>
		<div id="cd-tab0" class="modal-side fade" style="display: none">
			<div id="event-no" class="text-center text-muted" style="display: none">暂无活动</div>
			<div class="tab-list" style="display: none">
				<!--example start-->
				<label class="list-label notin">未开始</label>
				<div class="list-cont">
					<b class="list-name">升旗仪式</b><br>
					<span class="list-time">每周一 08:51至09:30</span>
				</div>
			</div>
			<!--example end-->
		</div>
		<div id="cd-tab1" class="modal-side fade" style="display: none">
			<h3>v0.4</h3>
			<h4>v0.4.0</h4>
			<div class="py-2"><label class="list-label">修复</label>修复托管缓存导致的音乐播放问题</div>
			<div class="py-2"><label class="list-label">新增</label>新增单次活动</div>
			<div class="py-2"><label class="list-label">新增</label>新增调色板页面</div>
			<div class="py-2"><label class="list-label">新增</label>新增引导按钮，提升使用体验</div>
			<div class="py-2"><label class="list-label">优化</label>微调页面，降低交互性</div>
			<br><br>
			<h3>v0.3</h3>
			<h4>v0.3.4</h4>
			<div class="py-2"><label class="list-label">修复</label>修复音乐播放问题</div>
			<div class="py-2"><label class="list-label">新增</label>新增活动列表及更新日志</div>
			<div class="py-2"><label class="list-label">优化</label>布局调整，更简约美观</div>
			<div class="py-2"><label class="list-label">优化</label>解决浏览器自动播放问题</div>
			<br>
			<h4>v0.3.3~v0.3.0</h4>
			<div class="py-2"><label class="list-label">优化</label>我说优化就是优化</div>
			<br><br>
			<h3>v0.2</h3>
			<div class="py-2"><label class="list-label">修复</label>修复周期性问题</div>
			<div class="py-2"><label class="list-label">新增</label>添加全部音乐</div>
			<br><br>
			<h3>v0.1</h3>
			<div class="py-2"><label class="list-label">新增</label>基本框架</div>
		</div>
		<div id="cd-tabback" class="modal-backdrop fade" style="display: none"></div>
		<div class="cd-tabs">
			<div id="tab0" class="cd-tab"><i class="fa fa-podcast"></i> 活动</div>
			<div id="tab1" class="cd-tab"><i class="fa fa-bars"></i> 更新日志</div>
			<div id="tab2" class="cd-tab"><i class="fa fa-adjust"></i> 摆烂式调色板</div>
		</div>
		<div class="cd-tabs-right text-center">
			<span id="nxt" class="cd-tab-right">下节/当前：某节休息</span>
		</div>
		<div class="text-center py-5 cd-header">
			<b class="cd-descr">距离</b>
			<b class="cd-descr" id="title-to">某天</b>
			<b class="cd-descr" id="title-pre">第某节课</b>
			<label class="cd-title" id="title"> 某节课 </label>
			<b class="cd-descr" id="title-sub">上/下课</b>
			<b class="cd-descr" id="descr">还有</b>
		</div>
		<div class="text-center" id="cd-time">
			<label class="cd-time" id="hor"> 00 </label> <b class="cd-descr">小时</b>
			<label class="cd-time" id="min"> 00 </label> <b class="cd-descr">分钟</b>
			<label class="cd-time" id="sec"> 00 </label> <b class="cd-descr">秒</b>
		</div>
		<div style="display: none" class="text-center cd-music text-muted" id="cd-music">
			<i class="fa fa-music"></i>
			<span>当前播放：</span>
			<span id="music-name">某首歌</span>
		</div>
		<div class="text-center cd-footer text-muted">
			<span>SESCountdown v0.4 DEMO</span><br>
			<span>Made By JasonYing.</span><br>
			<span>当前为开发版本，包括了非常多没写完但急于上线的东西，敬请谅解。</span>
		</div>
	</div>
	<script>
		let dailyEventList = ["0758", "0848", "0931", "0950", "1043", "1228", "1318", "1408", "1505", "1558", "1700"];
		let dailyEventMusic = [0, 0, 5, 3, 0, 0, 0, 0, 3, 0, 6];

		let timeStampList = ["0800", "0840", "0850", "0930", "0955", "1035", "1045", "1125", "1230", "1310", "1320", "1400", "1410", "1450", "1510", "1550", "1600", "1650"];
		let timeStampDescrPre = ["第一节课", "第一节课", "第二节课", "第二节课", "第三节课", "第三节课", "第四节课", "第四节课", "第五节课", "第五节课", "第六节课", "第六节课", "第七节课", "第七节课", "第八节课", "第八节课", "第九节课", "第九节课"];
		let timeStampDescrSub = ["上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课", "上课", "下课"];
		let timeStampMusic = [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, -1]

		let schedList = [
			["化学", "升旗仪式", "英语", "数学", "体育", "劳技", "物理", "语文", "TI"],
			["思想政治", "数学", "语文", "语文", "英语", "化学", "生物", "历史", "体育"],
			["物理", "历史", "信息科技", "信息科技", "语文", "数学", "音乐美术", "英语", "体育"],
			["英语", "数学", "物理", "语文", "地理", "化学", "特需自修", "特需自修", "特需自修"],
			["化学", "数学", "历史", "英语", "物理", "思想政治", "班会", "无", "无"]
		];
		let spanList = ["放学", "课间", "大课间", "课间", "午休", "课间", "课间", "大课间", "课间", "放学"];

		let musicList = ["pre.aac", "on.aac", "off.aac", "eye.mp3", "inbody.aac", "body.mp3", "neversaygoodbye.aac"];
		let musicDescr = ["预备铃", "上课铃", "下课铃", "眼保健操", "室内操", "广播体操", "Never Say Goodbye"];

		let weeklyEventList = ["10851", "20931", "30931", "40931", "50931"];
		let weeklyEventEnd = ["10930", "-1", "-1", "-1", "-1"];
		let weeklyName = ["-1", "每周一", "每周二", "每周三", "每周四", "每周五"];
		let weeklyEventMusic = [-1, -2, -2, -2, -2];
		let weeklyEventDescr = ["升旗仪式", "-1", "-1", "-1", "-1"];
		let weeklyEventLink = ["https:\/\/ke.qq.com\/webcourse\/2537352\/102642177#taid=9050075915794312&lite=1"];

		let onceEventList = ["202203231540"];
		let onceEventEnd = ["202203231640"];
		let onceEventDescr = ["天宫课堂第二课"];
		let onceEventLink = ["https://tv.cctv.com/live/cctv1"];
	</script>
	<script>
		function add0(s) {
			return ("00" + s).substr(-2);
		}
		function getAdjDay() {
			return (new Date().getDay() - 1 + 7) % 7 + 1;
		}
		function getNowStr() {
			return add0(new Date().getHours().toString()) + add0(new Date().getMinutes().toString());
		}
		function getNowWkStr() {
			return getAdjDay().toString() + getNowStr();
		}
		function getNowOnceStr() {
			return new Date().getFullYear().toString() + add0(new Date().getMonth().toString()) + add0(new Date().getDate().toString()) + getNowStr();
		}
	</script>
	<script>
		function initTabs() {
			let tabOpen = ["-1", "-1", "./color.html"];
			for (let i = 0; i < 10; i++) {
				if (document.getElementById("tab" + i.toString()) === null) break;
				if (document.getElementById("cd-tab" + i.toString()) === null) {
					$("#tab" + i.toString()).on("click", function () { window.open(tabOpen[i]); });
					continue;
				}
				$("#tab" + i.toString()).on("click", function () { showTab(i); });
			}
			$("#cd-tabback").on("click", function () { hideTab(); });
		}
		initTabs();
		function showTab(n) {
			$("#cd-tabback").addClass("show");
			$("#cd-tabback").show();
			$("#cd-tab" + n.toString()).addClass("show");
			$("#cd-tab" + n.toString()).show();
		}
		function hideTab() {
			for (let i = 0; i < 10; i++) {
				if (document.getElementById("cd-tab" + i.toString()) === null) return;
				$("#cd-tabback").removeClass("show");
				$("#cd-tabback").hide();
				$("#cd-tab" + i.toString()).removeClass("show");
				$("#cd-tab" + i.toString()).hide();
			}
		}

		let eventModal =
			"<div class=\"tab-list\">" +
			"<label class=\"list-label EVENTCLR\">EVENTSTAT</label>" +
			"<div class=\"list-cont\">" +
			"<b class=\"list-name\">EVENTNAME</b><br>" +
			"<span class=\"list-time\">EVENTTIME</span>" +
			"</div>" +
			"</div>";
		function showEvent() {
			let hasEvent = false;
			let eventCnt = 1;
			for (let i = 0; i < weeklyEventList.length; i++) {
				if (weeklyEventDescr[i] == "-1" || weeklyEventEnd[i] == "-1") continue;
				hasEvent = true;

				let evm = eventModal;
				if (weeklyEventList[i] <= getNowWkStr() && getNowWkStr() <= weeklyEventEnd[i]) {
					evm = evm.replace(/EVENTSTAT/g, "进行中");
					evm = evm.replace(/EVENTCLR/g, "in");
				}
				else {
					evm = evm.replace(/EVENTSTAT/g, "未开始");
					evm = evm.replace(/EVENTCLR/g, "notin");
				}
				evm = evm.replace(/EVENTNAME/g, weeklyEventDescr[i]);
				evm = evm.replace(/EVENTTIME/g,
					weeklyName[weeklyEventList[i][0]] + " " + weeklyEventList[i].substring(1, 3) + ":" + weeklyEventList[i].substring(3, 5)
					+ "至" + weeklyEventEnd[i].substring(1, 3) + ":" + weeklyEventEnd[i].substring(3, 5));

				$("#cd-tab0").append(evm);
				$("#cd-tab0 .tab-list:eq(" + eventCnt.toString() + ")").on("click", function () { window.open(weeklyEventLink[i]); });
				eventCnt++;
			}
			for (let i = 0; i < onceEventList.length; i++) {
				if (onceEventDescr[i] == "-1" || onceEventEnd[i] == "-1") continue;
				hasEvent = true;

				let evm = eventModal;
				if (onceEventList[i] <= getNowOnceStr() && getNowOnceStr() <= onceEventEnd[i]) {
					evm = evm.replace(/EVENTSTAT/g, "进行中");
					evm = evm.replace(/EVENTCLR/g, "in");
				}
				else {
					evm = evm.replace(/EVENTSTAT/g, "未开始");
					evm = evm.replace(/EVENTCLR/g, "notin");
				}
				evm = evm.replace(/EVENTNAME/g, onceEventDescr[i]);
				evm = evm.replace(/EVENTTIME/g,
					onceEventList[i].substring(0, 4) + "/" + onceEventList[i].substring(4, 6) + "/" + onceEventList[i].substring(6, 8) + " " +
					onceEventList[i].substring(8, 10) + ":" + onceEventList[i].substring(10, 12));

				$("#cd-tab0").append(evm);
				$("#cd-tab0 .tab-list:eq(" + eventCnt.toString() + ")").on("click", function () { window.open(onceEventLink[i]); });
				eventCnt++;
			}
			if (!hasEvent) $("#event-no").show();
			else $("#event-no").hide();
		}
		showEvent();
	</script>
	<script>
		let player;
		function playMusic(n) {
			if (n < 0) return;
			let s = musicList[n];
			let mp3 = "./assets/music/" + s + "?" + (new Date().getTime() / 86400000).toString();
			player = new Audio(mp3);
			document.getElementById("cd-music").appendChild(player);
			player.play();
			$("#music-name").text(musicDescr[n]);
			$("#cd-music").fadeIn(2000);
			player.addEventListener("ended", function () {
				$("#cd-music").fadeOut(2000);
			}, false)
		}
		function nxtSchedId() {
			if (toNxtWorkDay()) return 0;
			let nowStr = getNowStr();
			let i;
			for (i = 0; i < timeStampList.length; i++) {
				if (nowStr < timeStampList[i]) return i;
			}
		}
		function str2time(n) {
			let todayStart = new Date().getTime() - new Date().getHours() * 60 * 60 * 1000 - new Date().getMinutes() * 60 * 1000 - new Date().getSeconds() * 1000 - new Date().getMilliseconds();
			let thisHour = parseInt(timeStampList[n].substring(0, 2));
			let thisMin = parseInt(timeStampList[n].substring(2, 4));
			let nowTime = todayStart + thisHour * 60 * 60 * 1000 + thisMin * 60 * 1000;
			return nowTime;
		}
		let toNxtDescr = ["-1", "明天", "后天"];
		function toNxtWorkDay() {
			let nowDay = getAdjDay();
			if (nowDay >= 1 && nowDay <= 4) {
				if (getNowStr() <= timeStampList[timeStampList.length - 1]) {
					$("#title-to").text("");
					return 0;
				}
				$("#title-to").text(toNxtDescr[1]);
				return 1;
			}
			if (nowDay == 5) {
				if (getNowStr() <= timeStampList[timeStampList.length - 1]) {
					$("#title-to").text("");
					return 0;
				}
			}
			$("#title-to").text(toNxtDescr[8 - nowDay]);
			return 8 - nowDay;
		}
	</script>
	<script>
		let delta, nxtId, preId, preStr, preWkStr;
		function refr() {
			if (preStr != getNowStr() && !toNxtWorkDay()) {
				preStr = getNowStr();
				for (let i = 0; i < dailyEventList.length; i++) {
					if (dailyEventList[i] == preStr) {
						playMusic(dailyEventMusic[i]);
						break;
					}
				}
			}
			if (preWkStr != getNowWkStr()) {
				preWkStr = getNowWkStr();
				for (let i = 0; i < weeklyEventList.length; i++) {
					if (weeklyEventList[i] == preWkStr) {
						playMusic(weeklyEventMusic[i]);
						// $("#prompt-cont").html(weeklyEventPrompt[i]);
						break;
					}
				}
			}
			nxtId = nxtSchedId();
			delta = str2time(nxtId) - new Date().getTime();
			delta = delta / 1000 + (toNxtWorkDay() * 24 * 60 * 60);
			updTime();
			if (nxtId != preId) updSched();
		}
		function updTime() {
			let hor = Math.floor(delta / 3600);
			let min = Math.floor(delta / 60 - hor * 60);
			let sec = Math.floor(delta - hor * 3600 - min * 60);
			$("#hor").html(" " + add0(hor) + " ");
			$("#min").html(" " + add0(min) + " ");
			$("#sec").html(" " + add0(sec) + " ");
		}
		function updSched() {
			if (timeStampList[nxtId - 1] == getNowStr()) playMusic(timeStampMusic[nxtId - 1]);
			preId = nxtId;
			if (nxtId % 2 == 0) $("#nxt").text("当前：" + spanList[Math.floor(nxtId / 2)]);
			else $("#nxt").text("下节：" + spanList[Math.floor(nxtId / 2) + 1]);
			$("#title-pre").text(timeStampDescrPre[nxtId]);
			if (Math.floor(nxtId / 2) >= schedList[(getAdjDay() + toNxtWorkDay()) % 7 - 1].length) $("#title").innerText = " 明天 ";
			else $("#title").text(" " + schedList[(getAdjDay() + toNxtWorkDay()) % 7 - 1][Math.floor(nxtId / 2)] + " ");
			$("#title-sub").text(timeStampDescrSub[nxtId]);
		}
		setInterval(function () { refr() }, 1000);
		// $.get("https://api.help.bj.cn/apis/weather/?id=101020600", function (data) {
		// 	alert(data.city);
		// })
	</script>
</body>

</html>